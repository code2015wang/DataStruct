## 网易2016校招二

1. 设有两个事务T1,T2,其并发操作如下所示,下面评价正确的是() 

>    步骤          T1         T2  
>
>    1          读A=100  
>
>    2                           读A=100  
>
> 3. ​        A=A+10写回  
> 4. ​                           A=A-10写回  

A. 该操作不能重复读

B. 该操作不存在问题

C. 该操作读脏数据

D. 该操作丢失修改

### 事务的4大特性

+ 原子性 ：事务作为一个整体被执行，包含在其中的对数据库操作要么全部执行，要么都不执行。
+ 一致性 ：事务应确保数据库的状态从一个一致状态转换到另一个一致状态
+ 隔离性 ：多个事务并发执行，一个事务的执行不影响其他事务的执行
+ 持久性 : 一个事务一旦提交，它对数据库的修改应该是永久保存在数据库中。

### 数据库并发操作产生的问题

+ 丢失修改

| 事务A       | 事务B       |
| --------- | --------- |
| 读取x=100   | 读取x=100   |
| 写入x=x+100 | 写入x=x+200 |
| 事务结束x=200 | 事务结束x=300 |
|           | 最后x=300   |

两个不同事务同时获得相同的数据，然后在各自事务中同时修改了该数据，那么先提交的事务更新会被后提交的事务更新覆盖掉。

+ 脏读

| 事务A                   | 事务B              |
| --------------------- | ---------------- |
|                       | 写入x=x+100（x=200） |
| 读取x=200（读取了事务B未提交的数据） |                  |
|                       | 事务回滚x=100        |
|                       | 事务结束x=100        |
| 事务结束                  |                  |

事务A读取了未提交的数据，事务B的回滚，导致了事务A的数据不一致，导致事务A的脏读。

+ 不可重复读

一个事务在自己没有更新数据库的情况下，同一查询操作执行两次或多次的结果应该是一致的，如果不一致，就说明为不可重复读

| 事务A                       | 事务B       |
| ------------------------- | --------- |
| 读取x=100                   | 读取x=100   |
| 读取x=100                   | 写入x=x+100 |
|                           | 写入x=x+100 |
| 读取x=200（此时同一事务，读取x值发生了变化） |           |
| 事务结束                      |           |

事务A多次读取x的结果出现不一致，即为不可重复读

+ 幻读

一个事务读取同一条记录2次，得到的结果不一样。

### 数据库锁机制

+ 锁的两种分类

  > 从数据库的角度来看，锁分为一下三种类型：mysql锁机制分为表级锁，行级锁，行级锁包括共享锁、排它锁和更新锁。排它锁，只允许锁定操作的程序使用，其他对它的任何操作均不会被接受。执行数据更新命令，即inset、update或delete命令，数据库自动使用独占锁。共享锁：锁定的资源可以被其他用户使用，但其他用户不能修改它。更新锁，是为防止死锁而设立的，当数据库更新数据的时候，它首先对数据对象作更新锁锁定，这样数据就不能被修改，但可以读取。确定进行更新数据，它自动将更新锁换为独占锁。

  > 从程序员的角度来说，锁分为两种类型，乐观锁和悲观锁。悲观锁，指对数据被外界修改持保守态度，因此整个数据处理过程中，将数据处于锁定状态。悲观锁的实现，往往依靠数据库的锁机制。乐观锁，采取更加宽松的的加锁机制。悲观锁对于长事务开销较大。乐观锁，往往基于数据版本记录机制实现。

2. mysql实现的四种通信协议

   > MySQL实现了四种通信协议 
   >
   > 1.    TCP/IP协议，通常我们通过来连接MySQL，各种主要编程语言都是根据这个协议实现了连接模块  
   > 2.    Unix    Socket协议，这个通常我们登入MySQL服务器中使用这个协议，因为要使用这个协议连接MySQL需要一个物理文件，文件的存放位置在配置文件中有定义，值得一提的是，这是所有协议中最高效的一个。  
   > 3.    Share    Memory协议，这个协议一般人不知道，肯定也没用过，因为这个只有windows可以使用，使用这个协议需要在配置文件中在启动的时候使用–shared-memory参数，注意的是，使用此协议，一个host上只能有一个server，所以这个东西一般没啥用的，除非你怀疑其他协议不能正常工作，实际上微软的SQL    Sever也支持这个协议  
   > 4.    Named Pipes协议(命名管道)，这个协议也是只有windows才可以用，同shared    memory一样，使用此协议，一个host上依然只能有一个server，即使是使用不同的端口也不行，Named Pipes    是为局域网而开发的协议。内存的一部分被某个进程用来向另一个进程传递信息，因此一个进程的输出就是另一个进程的输入。第二个进程可以是本地的（与第一个进程位于同一台计算机上），也可以是远程的（位于联网的计算机上）。正因为如此，假如你的环境中没有或者禁用TCP/IP环境，而且是windows服务器，那么好歹你的数据库还能工作。使用这个协议需要在启动的时候添加–enable-named-pipe选项

3.   CPU和两台输入/输出设备(I1,I2)多道程序设计环境下,同时有三个作业J1,J2,J3进行,这三个作业 

     使用CPU和输入/输出设备的顺序和时间如下所示: 

   >    J1:I2(35ms);CPU(15ms);I1(35ms);CPU(15ms);I2(25ms)  
   >
   >    J2:I1(25ms);CPU(30ms);I2(35ms)  
   >
   >    J3:CPU(30ms);I1(25ms);CPU(15ms);I1(15ms);  

假定CPU,I1,I2都能并行工作,J1的优先级最高,J2次之,J3优先级最低,优先级高的作业可以抢占优先级低的作业的CPU,但不能抢占I1,I2,作业从J3开始到完成需要多少时间?

解析：图示 

| CPU   | I1    | I2    | Time | Msg  |
| ----- | ----- | ----- | ---- | ---- |
| J3:25 | J2:25 | J1:25 | 25   |      |
| J2:10 |       | J1:10 | 10   |      |
| J1:15 |       |       | 15   |      |
| J2:20 | J1:20 |       | 20   |      |
| J3:5  | J1:5  | J2:5  | 5    |      |
|       | J1:10 | J2:10 | 10   |      |
| J1:15 | J3:15 | J2:15 | 15   |      |
|       | J3:5  | J2:5  | 5    | J2结束 |
|       | J3:5  | J1:5  | 5    |      |
| J3:15 |       | J1:15 | 15   |      |
|       | J3:5  | J1:5  | 5    | J1结束 |
|       | J3:10 |       | 10   | J3结束 |
|       |       |       | 140  |      |

4. linux chomd命令

chmod命令用于改变linux系统文件或着目录的访问权限，用它控制文件或目录的访问权限。该命令有两种用法。一种是包含字母和操作符表达式的文字设定法，一种是包含数字设定法。文件或目录的访问权限分为只读、只写和可执行三种。每一文件或目录的访问权限都有三组，每组用三位表示，分别为文件属主的读、写和执行权限；与属主同组的用户的读、写和执行权限；系统中其他用户的读、写和执行权限。

+ 权限范围

u ：目录或者文件的当前的用户
g ：目录或者文件的当前的群组
o ：除了目录或者文件的当前用户或群组之外的用户或者群组
a ：所有的用户及群组

+ 权限代号

r ：读权限，用数字4表示
w ：写权限，用数字2表示
x ：执行权限，用数字1表示

-：删除权限，用数字0表示

s ：特殊权限 

5. 新建一个管理员用户admin,需要使用的参数()

> ```
> useradd -u 0 -o admin
> ```
>
> -u 用户号 指定用户的用户号；因为系统用户的用户号为0，故指定用户号为0 如果同时有-o选项，则可以重复使用其他用户的标识号；因为系统本身存在用户号为0的系统用户，故应该使用该参数。

6. 下面()组命令,将变量count值赋值为1

> ```
> A. DIM@count=1 count=1
> ```
>
> ```
> B.DECLARE @count SELECT @count=1
> C. DECLARE count SELECT count=1
> D. DIM @count SELECT @count=1
> ```

答案B,

> @表示声明一个局部变量，@@表示声明一个全局变量（比如已经定义好的系统变量）
>
> 申明局部变量语法：declare @变量名 数据类型；例如：declare @num int；
>
> 赋值：有两种方法式（@num为变量名，value为值）
>
> set @num=value;   或   select @num=value;
>
>   选项的格式有问题，会使人造成误解。正确的书写形式是 
>
>   DECLARE @count 
>
>   SELECT  @count＝1 
>
>   解释如下： 
>
>   DECLARE 用于声明变量， 
>
>   SELECT  用于变量赋值。 

7. 截止JDK1.8版本,java并发框架支持锁包括?

读写锁、自旋锁和乐观锁

